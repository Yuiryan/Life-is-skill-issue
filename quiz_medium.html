<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shiro – Medium Quiz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700&display=swap">
    <link rel="stylesheet" href="assets/ui.css">
    <script src="assets/ui.js" defer></script>
    <style>
        *{
            box-sizing:border-box;
            margin:0;
            padding:0;
            font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
        }

        body{
            background:#f3f4f6;
            color:#111827;
            min-height:100vh;
            display:flex;
            flex-direction:column;
            animation:pageFadeIn .4s ease-out;
        }

        @keyframes pageFadeIn{
            from{opacity:0;transform:translateY(8px);}
            to{opacity:1;transform:translateY(0);}
        }

        .navbar{
            height:clamp(60px,9vw,72px);
            border-bottom:1px solid #e5e7eb;
            display:flex;
            align-items:center;
            justify-content:space-between;
            padding:0 clamp(16px,4vw,48px);
            background:#fff;
        }

        .nav-left{
            display:flex;
            align-items:center;
            gap:12px;
        }

        .nav-left img{
            height:clamp(40px,8vw,64px);
            width:clamp(40px,8vw,64px);
            object-fit:contain;
        }

        .brand-name{
            font-family:'Nunito',sans-serif;
            font-weight:700;
            font-size:clamp(18px,2.6vw,24px);
        }

        .nav-right{
            font-size:13px;
            color:#6b7280;
            cursor:pointer;
        }

        .nav-right:hover{color:#111827;}

        .main{
            flex:1;
            display:flex;
            justify-content:center;
            align-items:center;
            padding:clamp(16px,5vw,64px);
        }

        .card{
            background:#fff;
            color:#111827;
            border-radius:24px;
            padding:clamp(20px,4vw,36px);
            max-width:720px;
            width:min(100%,720px);
            box-shadow:0 20px 50px rgba(15,23,42,.12);

            display:flex;
            flex-direction:column;
            align-items:stretch;

            animation:cardIn .35s ease-out;
        }

        @keyframes cardIn{
            from{opacity:0;transform:scale(.97);}
            to{opacity:1;transform:scale(1);}
        }

        .question-top-label{
            font-size:12px;
            color:#6b7280;
            margin-bottom:6px;
        }

        .definition{
            font-size:22px;
            font-weight:600;
            margin-bottom:24px;
        }

        .question-image-box{
            display:flex;
            justify-content:center;
            margin-bottom:18px;
        }

.question-image-box img {
    width: min(320px, 80vw); /* co theo chiều rộng màn hình, max ~320px */
    aspect-ratio: 1 / 1;     /* giữ tỉ lệ vuông */
    object-fit: contain;     /* không cắt mất nội dung ảnh */
    border-radius: 16px;
    background: #f9fafb;
}


        .answers-label{
            font-size:13px;
            margin-bottom:8px;
            color:#4b5563;
            text-align:center;
        }

        .answers-row{
            display:flex;
            justify-content:center;
            gap:16px;
            flex-wrap:wrap;
        }

        .answer-btn{
            flex:0 0 40%;
            border-radius:14px;
            border:1px solid #e5e7eb;
            background:#f9fafb;
            color:#111827;
            padding:14px 16px;
            text-align:center;
            font-size:14px;
            cursor:pointer;
            min-height:56px;
            transition:background .15s ease,border-color .15s ease;
            --hover-shadow:0 14px 28px rgba(15,23,42,.08);
        }

        .answer-btn:hover{
            background:#e5f2ff;
            border-color:#93c5fd;
            transform:translateY(-1px);
        }

        .answer-btn.correct{
            background:#dcfce7;
            border-color:#22c55e;
        }

        .answer-btn.wrong{
            background:#fee2e2;
            border-color:#f97373;
        }

        .answer-btn:disabled{
            cursor:default;
            opacity:.95;
        }

        .feedback{
            margin-top:14px;
            font-size:14px;
            min-height:20px;
            text-align:center;
        }

        .feedback.correct{color:#16a34a;}
        .feedback.wrong{color:#dc2626;}

        .progress{
            margin-top:4px;
            font-size:12px;
            color:#6b7280;
            text-align:center;
        }

        .restart-btn{
            margin:18px auto 0;
            border-radius:999px;
            border:none;
            padding:10px 20px;
            font-size:14px;
            font-weight:600;
            background:#22c55e;
            color:#fff;
            cursor:pointer;
            display:block;
            box-shadow:0 10px 24px rgba(34,197,94,.35);
            --hover-shadow:0 16px 32px rgba(34,197,94,.45);
        }

        .restart-btn:hover{background:#16a34a;}

        @media (max-width:600px){
            .navbar{
                flex-direction:column;
                gap:8px;
                height:auto;
                padding:16px;
            }

            .card{padding:20px 16px 18px;border-radius:20px;}
            .question-image-box img{width:150px;height:150px;}
            .answer-btn{flex:1 1 100%;}
        }

        body.resume-modal-open{
            overflow:hidden;
        }

        .resume-overlay{
            position:fixed;
            inset:0;
            display:flex;
            align-items:center;
            justify-content:center;
            padding:24px;
            background:rgba(15,23,42,.45);
            backdrop-filter:blur(18px);
            -webkit-backdrop-filter:blur(18px);
            opacity:0;
            pointer-events:none;
            transition:opacity .25s ease;
            z-index:1000;
        }

        .resume-overlay.is-open{
            opacity:1;
            pointer-events:auto;
        }

        .resume-dialog{
            width:min(420px,90vw);
            background:rgba(255,255,255,.9);
            border-radius:24px;
            padding:clamp(20px,4vw,32px);
            text-align:center;
            box-shadow:0 25px 60px rgba(15,23,42,.25);
            backdrop-filter:blur(6px);
            -webkit-backdrop-filter:blur(6px);
        }

        .resume-title{
            font-size:1.15rem;
            font-weight:700;
            margin-bottom:8px;
        }

        .resume-message{
            font-size:.95rem;
            color:#4b5563;
            line-height:1.5;
            margin-bottom:20px;
        }

        .resume-actions{
            display:flex;
            flex-direction:column;
            gap:12px;
        }

        .resume-btn{
            border:none;
            border-radius:999px;
            padding:12px 20px;
            font-size:15px;
            font-weight:600;
            cursor:pointer;
            transition:transform .15s ease,box-shadow .15s ease;
        }

        .resume-btn:focus{
            outline:2px solid #2563eb;
            outline-offset:3px;
        }

        .resume-btn.primary{
            background:#2563eb;
            color:#fff;
            box-shadow:0 12px 30px rgba(37,99,235,.35);
        }

        .resume-btn.primary:hover{
            transform:translateY(-1px);
            box-shadow:0 16px 32px rgba(37,99,235,.4);
        }

        .resume-btn.ghost{
            background:rgba(255,255,255,.85);
            color:#111827;
            border:1px solid rgba(17,24,39,.08);
        }

        .resume-btn.ghost:hover{
            background:rgba(249,250,251,.95);
            transform:translateY(-1px);
        }

        @media (min-width:480px){
            .resume-actions{
                flex-direction:row;
            }

            .resume-actions .resume-btn{
                flex:1;
            }
        }
    </style>
</head>
<body>
<header class="navbar">
    <div class="nav-left">
        <img src="assets/logo.png" alt="Shiro logo">
        <div class="brand-name">Shiro – Medium</div>
    </div>
    <button type="button" class="nav-right" id="btn-back-modes">
        Back to modes
    </button>
</header>

<main class="main">
    <div class="card" id="card">
        <div class="question-top-label" id="label-definition">Câu hỏi</div>
        <div class="definition" id="definition-text"></div>

        <div class="question-image-box">
            <img id="question-image" src="assets/m1.png" alt="illustration">
        </div>

        <div class="answers-label" id="label-choose">Hãy chọn đáp án</div>
        <div class="answers-row">
            <button type="button" class="answer-btn" id="ans-0"></button>
            <button type="button" class="answer-btn" id="ans-1"></button>
        </div>

        <div class="feedback" id="feedback"></div>
        <div class="progress" id="progress-text"></div>
    </div>
</main>

<div class="resume-overlay" id="resume-overlay" aria-hidden="true">
    <div class="resume-dialog">
        <div class="resume-title" id="resume-title"></div>
        <p class="resume-message" id="resume-message"></p>
        <div class="resume-actions">
            <button type="button" class="resume-btn primary" id="resume-continue"></button>
            <button type="button" class="resume-btn ghost" id="resume-restart"></button>
        </div>
    </div>
</div>

<script>
    // ===== 10 CÂU HỎI MEDIUM – mỗi câu có vi/en/jp =====
    // Gợi ý: tạo ảnh assets/m1.png ... m10.png
    const questions = [
        {
            vi: "Ảnh dưới là AI hay thật?",
            en: "Is the image below generated by AI or not?",
            jp: "下の写真は本物ですか、それともAIですか？",
            img: "assets/2.1.jpg",
            correct: 0
        },
        {
            vi: "Ảnh dưới là AI hay thật?",
            en: "Is the image below generated by AI or not?",
            jp: "下の写真は本物ですか、それともAIですか？",
            img: "assets/2.2.jpg",
            correct: 0
        },
        {
            vi: "Ảnh dưới là AI hay thật?",
            en: "Is the image below generated by AI or not?",
            jp: "下の写真は本物ですか、それともAIですか？",
            img: "assets/2.3.png",
            correct: 0
        },
        {
            vi: "Ảnh dưới là AI hay thật?",
            en: "Is the image below generated by AI or not?",
            jp: "下の写真は本物ですか、それともAIですか？",
            img: "assets/2.4.jpg",
            correct: 1
        },
        {
            vi: "Ảnh dưới là AI hay thật?",
            en: "Is the image below generated by AI or not?",
            jp: "下の写真は本物ですか、それともAIですか？",
            img: "assets/2.5.png",
            correct: 0
        },
        {
            vi: "Ảnh dưới là AI hay thật?",
            en: "Is the image below generated by AI or not?",
            jp: "下の写真は本物ですか、それともAIですか？",
            img: "assets/2.6.png",
            correct: 0
        },
        {
            vi: "Ảnh dưới là AI hay thật?",
            en: "Is the image below generated by AI or not?",
            jp: "下の写真は本物ですか、それともAIですか？",
            img: "assets/2.7.jpg",
            correct: 1
        },
        {
            vi: "Ảnh dưới là AI hay thật?",
            en: "Is the image below generated by AI or not?",
            jp: "下の写真は本物ですか、それともAIですか？",
            img: "assets/2.8.png",
            correct: 0
        },
        {
            vi: "Ảnh dưới là AI hay thật?",
            en: "Is the image below generated by AI or not?",
            jp: "下の写真は本物ですか、それともAIですか？",
            img: "assets/2.9.jpg",
            correct: 1
        },
        {
            vi: "Ảnh dưới là AI hay thật?",
            en: "Is the image below generated by AI or not?",
            jp: "下の写真は本物ですか、それともAIですか？",
            img: "assets/2,10.jpg",
            correct: 1
        }
    ];

    const uiTexts = {
        en: {
            defLabel: "Question",
            chooseLabel: "Please choose an answer",
            back: "Back to modes",
            correct: "Correct!",
            wrong: "Incorrect.",
            yes: "AI",
            no: "Not AI",
            progress: (cur, total) => `Question ${cur} of ${total}`,
            finished: (s, t) => `Finished! You got ${s} / ${t} correct.`,
            restart: "Restart",
            resumeTitle: "Pick up where you left off?",
            resumeMessage: (q) => `You stopped at question ${q} before answering. Continue?`,
            resumeContinue: "Continue",
            resumeRestart: "Start over"
        },
        vi: {
            defLabel: "Câu hỏi",
            chooseLabel: "Hãy chọn đáp án",
            back: "Về chọn chế độ",
            correct: "Đúng rồi!",
            wrong: "Sai mất rồi...",
            yes: "AI",
            no: "Không phải AI",
            progress: (cur, total) => `Câu ${cur} / ${total}`,
            finished: (s, t) => `Hoàn thành! Bạn đúng ${s} / ${t} câu.`,
            restart: "Làm lại",
            resumeTitle: "Tiếp tục làm tiếp?",
            resumeMessage: (q) => `Lần trước bạn dừng ở câu ${q} (chưa trả lời). Bạn có muốn tiếp tục không?`,
            resumeContinue: "Tiếp tục",
            resumeRestart: "Bắt đầu lại"
        },
        jp: {
            defLabel: "質問",
            chooseLabel: "答えを選んでください",
            back: "モード選択へ戻る",
            correct: "正解！",
            wrong: "不正解…",
            yes: "AI",
            no: "AIではない",
            progress: (cur, total) => `${total}問中 ${cur}問目`,
            finished: (s, tot) => `お疲れさま！ ${tot}問中${s}問正解しました。`,
            restart: "もう一度",
            resumeTitle: "再開しますか？",
            resumeMessage: (q) => `前回は第${q}問で中断しました（未回答）。続けますか？`,
            resumeContinue: "続ける",
            resumeRestart: "最初から"
        }
    };

    const btnBack         = document.getElementById("btn-back-modes");
    const labelDefinition = document.getElementById("label-definition");
    const labelChoose     = document.getElementById("label-choose");
    const definitionText  = document.getElementById("definition-text");
    const feedbackEl      = document.getElementById("feedback");
    const progressText    = document.getElementById("progress-text");
    const imageEl         = document.getElementById("question-image");
    const cardEl          = document.getElementById("card");

    const answerButtons = [
        document.getElementById("ans-0"),
        document.getElementById("ans-1")
    ];

    const resumeOverlay     = document.getElementById("resume-overlay");
    const resumeTitleEl     = document.getElementById("resume-title");
    const resumeMessageEl   = document.getElementById("resume-message");
    const resumeContinueBtn = document.getElementById("resume-continue");
    const resumeRestartBtn  = document.getElementById("resume-restart");

    const savedLang = localStorage.getItem("shiroLang") || "en";

    let current = 0;
    let score   = 0;
    let locked  = false;
    let currentLang = "en";
    let t       = uiTexts.en;
    let pendingResumeState = null;

    function updateResumeCopy(questionNumberOverride){
        const candidate = typeof questionNumberOverride === "number"
            ? questionNumberOverride
            : Math.min(current + 1, questions.length);

        resumeTitleEl.textContent = t.resumeTitle;
        resumeMessageEl.textContent = t.resumeMessage(candidate);
        resumeContinueBtn.textContent = t.resumeContinue;
        resumeRestartBtn.textContent = t.resumeRestart;
    }

    function applyLang(lang){
        currentLang = lang;
        t = uiTexts[lang] || uiTexts.en;

        labelDefinition.textContent = t.defLabel;
        labelChoose.textContent     = t.chooseLabel;
        btnBack.textContent         = t.back;

        const resumeNumber = pendingResumeState
            ? Math.min(sanitizeIndex(pendingResumeState.current) + 1, questions.length)
            : undefined;
        updateResumeCopy(resumeNumber);
        renderQuestion();
    }

    function renderQuestion(){
        const q = questions[current];

        cardEl.style.animation = "none";
        void cardEl.offsetWidth;
        cardEl.style.animation = "cardIn .35s ease-out";

        const qText = q[currentLang] || q.vi;
        definitionText.textContent = qText;

        imageEl.src = q.img;
        imageEl.style.visibility = "visible";

        feedbackEl.textContent = "";
        feedbackEl.className   = "feedback";

        answerButtons[0].textContent = t.yes;
        answerButtons[1].textContent = t.no;

        answerButtons.forEach(btn=>{
            btn.classList.remove("correct","wrong");
            btn.disabled = false;
            btn.style.display = "";
        });

        progressText.textContent = t.progress(current+1, questions.length);
        locked = false;
    }

    function showResult(){
        clearState();
        definitionText.textContent = "";
        imageEl.style.visibility   = "hidden";
        labelChoose.textContent    = "";
        feedbackEl.textContent     = t.finished(score, questions.length);
        feedbackEl.className       = "feedback correct";
        progressText.textContent   = "";

        answerButtons.forEach(btn=>btn.style.display="none");

    const restartBtn = document.createElement("button");
    restartBtn.className = "restart-btn";
    restartBtn.type = "button";
        restartBtn.textContent = t.restart;
        restartBtn.addEventListener("click", ()=>location.reload());
        cardEl.appendChild(restartBtn);
    }

    function handleAnswer(index){
        if(locked) return;
        locked = true;

        const q = questions[current];
        const nextIndex = current + 1;
        const willFinish = nextIndex >= questions.length;
        answerButtons.forEach(btn=>btn.disabled=true);

        if(index === q.correct){
            feedbackEl.textContent = t.correct;
            feedbackEl.className   = "feedback correct";
            answerButtons[index].classList.add("correct");
            score++;
        }else{
            feedbackEl.textContent = t.wrong;
            feedbackEl.className   = "feedback wrong";
            answerButtons[index].classList.add("wrong");
            answerButtons[q.correct].classList.add("correct");
        }

        current = nextIndex;
        persistState();

        setTimeout(()=>{
            if(!willFinish) renderQuestion();
            else showResult();
        },900);
    }

    answerButtons.forEach((btn,idx)=>{
        btn.addEventListener("click", ()=>handleAnswer(idx));
    });

    const STORAGE_KEY = "shiroQuiz_medium";

    function shouldPersistProgress(index = current){
        return Number.isFinite(index) && index > 0 && index < questions.length;
    }

    function persistState(){
        if(!shouldPersistProgress()){
            clearState();
            return;
        }

        try{
            const payload = { current, score, currentLang };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
        }catch(err){
            /* ignore */
        }
    }

    function readState(){
        try{
            const raw = localStorage.getItem(STORAGE_KEY);
            return raw ? JSON.parse(raw) : null;
        }catch(err){
            return null;
        }
    }

    function clearState(){
        try{
            localStorage.removeItem(STORAGE_KEY);
        }catch(err){
            /* ignore */
        }
    }

    function sanitizeIndex(value){
        const num = Number(value);
        if(!Number.isFinite(num)) return 0;
        return Math.min(Math.max(Math.floor(num), 0), questions.length - 1);
    }

    function sanitizeScore(value){
        const num = Number(value);
        if(!Number.isFinite(num) || num < 0) return 0;
        return Math.min(Math.floor(num), questions.length);
    }

    function hasResumeProgress(state){
        if(!state) return false;
        const idx = Number(state.current);
        return Number.isFinite(idx) && idx > 0 && idx < questions.length;
    }

    function openResumePrompt(state){
        pendingResumeState = state;
        const qNumber = Math.min(sanitizeIndex(state.current) + 1, questions.length);
        updateResumeCopy(qNumber);

        resumeOverlay.classList.add("is-open");
        resumeOverlay.setAttribute("aria-hidden","false");
        document.body.classList.add("resume-modal-open");

        requestAnimationFrame(()=>resumeContinueBtn.focus({preventScroll:true}));
    }

    function closeResumePrompt(){
        resumeOverlay.classList.remove("is-open");
        resumeOverlay.setAttribute("aria-hidden","true");
        document.body.classList.remove("resume-modal-open");
    }

    resumeContinueBtn.addEventListener("click", ()=>{
        if(!pendingResumeState){
            closeResumePrompt();
            return;
        }

        const targetIndex = sanitizeIndex(pendingResumeState.current);
        current = targetIndex;
        score = sanitizeScore(pendingResumeState.score);
        const langToApply = pendingResumeState.currentLang || savedLang;

        pendingResumeState = null;
        applyLang(langToApply);
        closeResumePrompt();
        persistState();
    });

    resumeRestartBtn.addEventListener("click", ()=>{
        pendingResumeState = null;
        current = 0;
        score = 0;
        clearState();
        renderQuestion();
        closeResumePrompt();
    });

    btnBack.addEventListener("click", ()=>{
        persistState();
        window.location.href = "quiz_home.html";
    });

    window.addEventListener("beforeunload", ()=>persistState());

    const savedState = readState();
    applyLang(savedLang);

    if(hasResumeProgress(savedState)){
        openResumePrompt(savedState);
    }else if(savedState){
        clearState();
    }
</script>
</body>
</html>
